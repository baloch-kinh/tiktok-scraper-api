const puppeteer = require('puppeteer'); 
 
(async () => {
  const browser = await puppeteer.launch({ headless: true });
  const page = await browser.newPage();

  // Set a common user-agent and viewport to reduce bot detection
  await page.setUserAgent('Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36');
  await page.setViewport({ width: 1280, height: 800 });

  // Navigate to the TikTok profile
  await page.goto('https://www.tiktok.com/@free_phalstin_free', { waitUntil: 'networkidle2' });

  // Wait for the main profile section to load
  await page.waitForSelector('h2[data-e2e="user-title"], h1[data-e2e="user-title"]', { timeout: 30000 });

  // Extract profile data
  const profileData = await page.evaluate(() => {
    // Try both h2 and h1 for name and username, as TikTok may change tags
    const name = document.querySelector('h2[data-e2e="user-title"], h1[data-e2e="user-title"]')?.innerText || '';
    const username = document.querySelector('h2[data-e2e="user-uniqueId"], h1[data-e2e="user-uniqueId"]')?.innerText || '';
    const stats = Array.from(document.querySelectorAll('strong[data-e2e^="followers-count"], strong[data-e2e^="following-count"], strong[data-e2e^="likes-count"]'))
      .map(el => el.innerText);

    // Fallback if selectors change
    const [followers, following, likes] = stats.length === 3 ? stats : ['', '', ''];

    return { name, username, followers, following, likes };
  });

  console.log(profileData);

  await browser.close();
})();


